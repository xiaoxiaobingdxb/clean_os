# 计算机启动流程

# 加电

主板通电后cpu加电，设置cs和ip寄存器的值分别为0xf000和0xfff0，此时cpu的程序指针指向0xfff0这个内存地址，而这个地址正是bios启动程序的位置，因此此时开始执行bios的启动程序。由于cpu将bios等芯片与设置与物理内存都虚拟化成寻址的内存，因此可以直接读取bios程序的指令并且执行之。

# bios执行

bios会先执行自检然后对设置执行简单的初始化工作：

在0x00000-0x003ff建立中断表

在0x00400-0x004ff构建bios数据区

在0x0e05b-0x1005a加载中断处理程序

然后bios根据设备启动顺序依次判断是否可启动

# 启动

bios发现硬盘启动标志后引发19号中断，这个断路会将MBR也就是磁头0、柱面0、扇区1的数据读取到内存0x7c00h的地方然后从0x7c00h这个内存地址开始执行指令，此时bios的程序执行完毕，cpu的控制权交由操作系统的boot代码。这里有MBR的代码有一个魔数要求，即512(一个扇区)的最后两个字节必须是0xaah和0x55h，这里55在低位，aa在高位。

# 实模式

由于intel cpu还需要兼容8086老的架构，因此当执行到MBR中的代码时cpu是运行在实模式中的。此时其实还是相当于使用的8086cpu，只有16位寄存器和20位地址总线，可访问的内存总量只有2^20也就是1Mb，最大分段为2^16也就是64k，并且由于bios等其他硬件设备也占用了内存的一部分，实际上可用的内存是少于1Mb的。而且由于boot代码都在一个扇区内，最多只有512个字节，最后两个字节还是魔数，因此最多只有510个字节可用，这对于一个操作系统来说是肯定不够的，因此boot程序还需要再去读磁盘数据加载到内存，引导真正的操作系统代码
